# –§–∏–Ω–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ external_id –¥–ª—è –≥–æ—Ä–æ–¥–æ–≤

## –ü—Ä–æ–±–ª–µ–º–∞

API blocks (–∏ –¥—Ä—É–≥–∏–µ API TrendAgent) —Ç—Ä–µ–±—É—é—Ç MongoDB ObjectId –¥–ª—è –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `city`, –Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ ObjectId –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, —Ç–∞–∫ –∫–∞–∫ –≤—Å–µ API endpoints —Ç—Ä–µ–±—É—é—Ç ObjectId –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞.

## –†–µ—à–µ–Ω–∏–µ: Seeder —Å –∏–∑–≤–µ—Å—Ç–Ω—ã–º–∏ ObjectId

–°–æ–∑–¥–∞–Ω seeder `UpdateCitiesExternalIdSeeder`, –∫–æ—Ç–æ—Ä—ã–π –æ–±–Ω–æ–≤–ª—è–µ—Ç external_id –¥–ª—è –≥–æ—Ä–æ–¥–æ–≤ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö ObjectId.

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```bash
php artisan db:seed --class=UpdateCitiesExternalIdSeeder
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

```
‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω –ú–æ—Å–∫–≤–∞ (guid: msk) ‚Üí external_id: 5a5cb42159042faa9a218d04
‚ö†Ô∏è  –ü—Ä–æ–ø—É—â–µ–Ω –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥ (guid: spb) - ObjectId –Ω–µ —É–∫–∞–∑–∞–Ω
...
üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
   –û–±–Ω–æ–≤–ª–µ–Ω–æ: 1
   –ü—Ä–æ–ø—É—â–µ–Ω–æ: 8
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ ObjectId –¥–ª—è –¥—Ä—É–≥–∏—Ö –≥–æ—Ä–æ–¥–æ–≤

1. –û—Ç–∫—Ä—ã—Ç—å —Ñ–∞–π–ª `database/seeders/UpdateCitiesExternalIdSeeder.php`
2. –î–æ–±–∞–≤–∏—Ç—å ObjectId –≤ –º–∞—Å—Å–∏–≤ `$citiesExternalIds`:

```php
$citiesExternalIds = [
    'msk' => '5a5cb42159042faa9a218d04',      // –ú–æ—Å–∫–≤–∞ ‚úÖ
    'spb' => 'OBJECT_ID_HERE',                // –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥
    'rostov' => 'OBJECT_ID_HERE',             // –†–æ—Å—Ç–æ–≤-–Ω–∞-–î–æ–Ω—É
    // ... –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ
];
```

3. –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ seeder:
   ```bash
   php artisan db:seed --class=UpdateCitiesExternalIdSeeder
   ```

## –ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å ObjectId –¥–ª—è –≥–æ—Ä–æ–¥–æ–≤

### –°–ø–æ—Å–æ–± 1: –ò–∑ –æ—Ç–≤–µ—Ç–∞ API blocks (–µ—Å–ª–∏ –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø)

1. –°–¥–µ–ª–∞—Ç—å –∑–∞–ø—Ä–æ—Å –∫ blocks API —Å –∏–∑–≤–µ—Å—Ç–Ω—ã–º ObjectId (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –ú–æ—Å–∫–≤—ã)
2. –í –æ—Ç–≤–µ—Ç–µ –Ω–∞–π—Ç–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –¥—Ä—É–≥–∏—Ö –≥–æ—Ä–æ–¥–∞—Ö —Å –∏—Ö ObjectId
3. –û–±–Ω–æ–≤–∏—Ç—å seeder —Å –Ω–∞–π–¥–µ–Ω–Ω—ã–º–∏ ObjectId

### –°–ø–æ—Å–æ–± 2: –ß–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å TrendAgent

–ï—Å–ª–∏ –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ TrendAgent, –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ ObjectId –≥–æ—Ä–æ–¥–æ–≤ —Ç–∞–º.

### –°–ø–æ—Å–æ–± 3: –ß–µ—Ä–µ–∑ SQL (–≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ)

–ú–æ–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ SQL:

```sql
UPDATE cities SET external_id = 'OBJECT_ID_HERE' WHERE guid = 'spb';
```

## –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å

‚úÖ –ú–æ—Å–∫–≤–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞ (external_id: `5a5cb42159042faa9a218d04`)  
‚è≥ –û—Å—Ç–∞–ª—å–Ω—ã–µ –≥–æ—Ä–æ–¥–∞ —Ç—Ä–µ–±—É—é—Ç –ø–æ–ª—É—á–µ–Ω–∏—è ObjectId

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

```sql
SELECT id, guid, name, external_id 
FROM cities 
WHERE is_active = 1 
  AND region_id IS NOT NULL
ORDER BY name;
```

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. –ü–æ–ª—É—á–∏—Ç—å ObjectId –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤
2. –û–±–Ω–æ–≤–∏—Ç—å seeder —Å –Ω–∞–π–¥–µ–Ω–Ω—ã–º–∏ ObjectId
3. –í—ã–ø–æ–ª–Ω–∏—Ç—å seeder –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤—Å–µ—Ö –≥–æ—Ä–æ–¥–æ–≤
4. –ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞—Ä—Å–µ—Ä blocks API –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

