import{d as y,a as g,b as k,c as w}from"./api-BACpyIk9.js";import{_ as j,c as i,a as t,b as m,t as l,F as x,q as _,w as S,d as c,I as M,A as C,v as b,N as p,o as n,p as v}from"./admin-Blbw7igg.js";const E={name:"ParserSchedules",data(){return{loading:!1,saving:!1,error:null,schedules:[],showCreateModal:!1,showEditModal:!1,form:{id:null,object_type:"",time_from:"",time_to:"",days_of_week:[],description:"",is_active:!0,check_images:!1,force_update:!1},daysOfWeek:["Пн","Вт","Ср","Чт","Пт","Сб","Вс"]}},async mounted(){await this.fetchSchedules()},methods:{async fetchSchedules(){this.loading=!0,this.error=null;try{const o=await w("/parser-schedules"),e=await o.json();o.ok?this.schedules=e.data||[]:this.error=e.message||"Ошибка при загрузке расписаний"}catch(o){console.error("Error fetching schedules:",o),this.error="Ошибка при загрузке расписаний"}finally{this.loading=!1}},async saveSchedule(){this.saving=!0;try{const o={...this.form,days_of_week:this.form.days_of_week.map(f=>parseInt(f))};let e;this.showEditModal?e=await g(`/parser-schedules/${this.form.id}`,o):e=await k("/parser-schedules",o);const a=await e.json();e.ok?(await this.fetchSchedules(),this.closeModal()):alert(a.message||"Ошибка при сохранении расписания")}catch(o){console.error("Error saving schedule:",o),alert("Ошибка при сохранении расписания")}finally{this.saving=!1}},editSchedule(o){this.form={id:o.id,object_type:o.object_type,time_from:o.time_from,time_to:o.time_to,days_of_week:o.days_of_week||[],description:o.description||"",is_active:o.is_active,check_images:o.check_images,force_update:o.force_update},this.showEditModal=!0},async toggleSchedule(o){try{const e=await g(`/parser-schedules/${o.id}`,{is_active:!o.is_active});if(e.ok)await this.fetchSchedules();else{const a=await e.json();alert(a.message||"Ошибка при обновлении расписания")}}catch(e){console.error("Error toggling schedule:",e),alert("Ошибка при обновлении расписания")}},async deleteSchedule(o){if(confirm(`Вы уверены, что хотите удалить расписание для "${this.getObjectTypeLabel(o.object_type)}"?`))try{const e=await y(`/parser-schedules/${o.id}`);if(e.ok)await this.fetchSchedules();else{const a=await e.json();alert(a.message||"Ошибка при удалении расписания")}}catch(e){console.error("Error deleting schedule:",e),alert("Ошибка при удалении расписания")}},closeModal(){this.showCreateModal=!1,this.showEditModal=!1,this.form={id:null,object_type:"",time_from:"",time_to:"",days_of_week:[],description:"",is_active:!0,check_images:!1,force_update:!1}},getObjectTypeLabel(o){return{blocks:"Квартиры (Блоки)",parkings:"Паркинги",villages:"Поселки",plots:"Участки","commercial-blocks":"Коммерческие объекты","commercial-premises":"Коммерческие помещения"}[o]||o},formatDaysOfWeek(o){if(!o||o.length===0)return"Не выбрано";const e=["Пн","Вт","Ср","Чт","Пт","Сб","Вс"];return o.map(a=>e[a-1]).join(", ")}}},V={class:"parser-schedules-page space-y-6"},U={class:"flex items-center justify-between mb-6"},D={key:0,class:"flex items-center justify-center py-12"},O={key:1,class:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg"},L={class:"text-destructive"},N={key:2,class:"space-y-4"},q={class:"flex items-start justify-between"},H={class:"flex-1"},P={class:"flex items-center gap-3 mb-2"},T={class:"text-lg font-semibold text-foreground"},W={class:"text-sm text-muted-foreground mb-4"},B={class:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm"},z={class:"ml-2 text-foreground"},F={class:"ml-2 text-foreground"},I={class:"ml-2 text-foreground"},A={class:"ml-2 text-foreground"},G={class:"flex gap-2 ml-4"},R=["onClick"],J=["onClick"],K=["onClick"],Q={key:3,class:"bg-card rounded-lg border border-border p-12 text-center"},X={key:4,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm"},Y={class:"bg-background border border-border rounded-lg shadow-2xl w-full max-w-2xl p-6 max-h-[90vh] overflow-y-auto"},Z={class:"text-lg font-semibold mb-4"},$={class:"grid grid-cols-2 gap-4"},ee={class:"grid grid-cols-7 gap-2"},te=["value"],se={class:"text-sm"},oe={class:"flex gap-4"},re={class:"flex items-center gap-2 cursor-pointer"},le={class:"flex items-center gap-2 cursor-pointer"},ie={class:"flex items-center gap-2 cursor-pointer"},ne={class:"flex gap-2 pt-4"},de=["disabled"];function ae(o,e,a,f,r,d){return n(),i("div",V,[t("div",U,[e[12]||(e[12]=t("div",null,[t("h1",{class:"text-3xl font-semibold text-foreground"},"Расписания парсера"),t("p",{class:"text-muted-foreground mt-1"},"Управление расписаниями автоматического парсинга")],-1)),t("button",{onClick:e[0]||(e[0]=s=>r.showCreateModal=!0),class:"h-11 px-6 bg-accent/10 backdrop-blur-xl text-accent border border-accent/40 hover:bg-accent/20 rounded-2xl shadow-lg shadow-accent/10 inline-flex items-center justify-center gap-2"},[...e[11]||(e[11]=[t("span",null,"+",-1),t("span",null,"Создать расписание",-1)])])]),r.loading?(n(),i("div",D,[...e[13]||(e[13]=[t("p",{class:"text-muted-foreground"},"Загрузка расписаний...",-1)])])):m("",!0),r.error?(n(),i("div",O,[t("p",L,l(r.error),1)])):m("",!0),!r.loading&&r.schedules.length>0?(n(),i("div",N,[(n(!0),i(x,null,_(r.schedules,s=>(n(),i("div",{key:s.id,class:"bg-card rounded-lg border border-border p-6"},[t("div",q,[t("div",H,[t("div",P,[t("h3",T,l(d.getObjectTypeLabel(s.object_type)),1),t("span",{class:v(["px-2 py-1 text-xs rounded-md",s.is_active?"bg-green-500/10 text-green-500":"bg-gray-500/10 text-gray-500"])},l(s.is_active?"Активно":"Неактивно"),3)]),t("p",W,l(s.description||"Нет описания"),1),t("div",B,[t("div",null,[e[14]||(e[14]=t("span",{class:"text-muted-foreground"},"Время:",-1)),t("span",z,l(s.time_from)+" - "+l(s.time_to),1)]),t("div",null,[e[15]||(e[15]=t("span",{class:"text-muted-foreground"},"Дни недели:",-1)),t("span",F,l(d.formatDaysOfWeek(s.days_of_week)),1)]),t("div",null,[e[16]||(e[16]=t("span",{class:"text-muted-foreground"},"Последний запуск:",-1)),t("span",I,l(s.last_run_at?new Date(s.last_run_at).toLocaleString("ru-RU"):"Не запускалось"),1)]),t("div",null,[e[17]||(e[17]=t("span",{class:"text-muted-foreground"},"Статус:",-1)),t("span",A,l(s.last_run_status||"-"),1)])])]),t("div",G,[t("button",{onClick:u=>d.editSchedule(s),class:"px-3 py-1 text-xs bg-blue-500 hover:bg-blue-600 text-white rounded transition-colors"}," Редактировать ",8,R),t("button",{onClick:u=>d.toggleSchedule(s),class:v(["px-3 py-1 text-xs rounded transition-colors",s.is_active?"bg-yellow-500 hover:bg-yellow-600 text-white":"bg-green-500 hover:bg-green-600 text-white"])},l(s.is_active?"Деактивировать":"Активировать"),11,J),t("button",{onClick:u=>d.deleteSchedule(s),class:"px-3 py-1 text-xs bg-red-500 hover:bg-red-600 text-white rounded transition-colors"}," Удалить ",8,K)])])]))),128))])):m("",!0),!r.loading&&r.schedules.length===0?(n(),i("div",Q,[...e[18]||(e[18]=[t("p",{class:"text-muted-foreground"},"Расписания не найдены",-1)])])):m("",!0),r.showCreateModal||r.showEditModal?(n(),i("div",X,[t("div",Y,[t("h3",Z,l(r.showEditModal?"Редактировать расписание":"Создать расписание"),1),t("form",{onSubmit:e[10]||(e[10]=S((...s)=>d.saveSchedule&&d.saveSchedule(...s),["prevent"])),class:"space-y-4"},[t("div",null,[e[20]||(e[20]=t("label",{class:"text-sm font-medium mb-1 block"},"Тип объекта *",-1)),c(t("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>r.form.object_type=s),required:"",class:"w-full h-10 px-3 border border-border rounded bg-background"},[...e[19]||(e[19]=[C('<option value="">Выберите тип</option><option value="blocks">Квартиры (Блоки)</option><option value="parkings">Паркинги</option><option value="villages">Поселки</option><option value="plots">Участки</option><option value="commercial-blocks">Коммерческие объекты</option><option value="commercial-premises">Коммерческие помещения</option>',7)])],512),[[M,r.form.object_type]])]),t("div",$,[t("div",null,[e[21]||(e[21]=t("label",{class:"text-sm font-medium mb-1 block"},"Время начала (HH:mm) *",-1)),c(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>r.form.time_from=s),type:"time",required:"",class:"w-full h-10 px-3 border border-border rounded bg-background"},null,512),[[b,r.form.time_from]])]),t("div",null,[e[22]||(e[22]=t("label",{class:"text-sm font-medium mb-1 block"},"Время окончания (HH:mm) *",-1)),c(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>r.form.time_to=s),type:"time",required:"",class:"w-full h-10 px-3 border border-border rounded bg-background"},null,512),[[b,r.form.time_to]])])]),t("div",null,[e[23]||(e[23]=t("label",{class:"text-sm font-medium mb-1 block"},"Дни недели *",-1)),t("div",ee,[(n(!0),i(x,null,_(r.daysOfWeek,(s,u)=>(n(),i("label",{key:u,class:"flex items-center gap-2 cursor-pointer p-2 border border-border rounded hover:bg-muted/10"},[c(t("input",{type:"checkbox",value:u+1,"onUpdate:modelValue":e[4]||(e[4]=h=>r.form.days_of_week=h)},null,8,te),[[p,r.form.days_of_week]]),t("span",se,l(s),1)]))),128))])]),t("div",null,[e[24]||(e[24]=t("label",{class:"text-sm font-medium mb-1 block"},"Описание",-1)),c(t("textarea",{"onUpdate:modelValue":e[5]||(e[5]=s=>r.form.description=s),rows:"3",class:"w-full px-3 py-2 border border-border rounded bg-background"},null,512),[[b,r.form.description]])]),t("div",oe,[t("label",re,[c(t("input",{type:"checkbox","onUpdate:modelValue":e[6]||(e[6]=s=>r.form.is_active=s)},null,512),[[p,r.form.is_active]]),e[25]||(e[25]=t("span",{class:"text-sm"},"Активно",-1))]),t("label",le,[c(t("input",{type:"checkbox","onUpdate:modelValue":e[7]||(e[7]=s=>r.form.check_images=s)},null,512),[[p,r.form.check_images]]),e[26]||(e[26]=t("span",{class:"text-sm"},"Проверять изображения",-1))]),t("label",ie,[c(t("input",{type:"checkbox","onUpdate:modelValue":e[8]||(e[8]=s=>r.form.force_update=s)},null,512),[[p,r.form.force_update]]),e[27]||(e[27]=t("span",{class:"text-sm"},"Принудительное обновление",-1))])]),t("div",ne,[t("button",{type:"button",onClick:e[9]||(e[9]=(...s)=>d.closeModal&&d.closeModal(...s)),class:"flex-1 h-10 px-4 border border-border bg-background/50 hover:bg-accent/10 rounded-lg transition-colors"}," Отмена "),t("button",{type:"submit",disabled:r.saving,class:"flex-1 h-10 px-4 bg-accent/10 backdrop-blur-xl text-accent border border-accent/40 hover:bg-accent/20 rounded-lg transition-colors disabled:opacity-50"},l(r.saving?"Сохранение...":"Сохранить"),9,de)])],32)])])):m("",!0)])}const me=j(E,[["render",ae]]);export{me as default};
