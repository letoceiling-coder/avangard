import{a as k,c as f}from"./api-BACpyIk9.js";import{_ as D,c as a,a as o,b as c,e as y,t as g,d as n,v as l,I as p,F as x,q as v,N as b,o as m}from"./admin-zkDx62Hg.js";const w={name:"ParserObjectEdit",data(){return{loading:!1,saving:!1,error:null,object:null,objectType:"blocks",objectId:null,cities:[],builders:[],formData:{name:"",address:"",city_id:null,builder_id:null,guid:"",external_id:"",latitude:null,longitude:null,min_price:null,max_price:null,apartments_count:null,view_apartments_count:null,exclusive_apartments_count:null,status:null,data_source:"parser",is_active:!0,is_suite:!1,is_exclusive:!1,is_marked:!1,deadline:"",deadline_date:"",finishing:""},originalData:{}}},computed:{hasChanges(){return JSON.stringify(this.formData)!==JSON.stringify(this.originalData)}},async mounted(){this.objectType=this.$route.params.type||"blocks",this.objectId=this.$route.params.id,await Promise.all([this.fetchObject(),this.fetchCities(),this.fetchBuilders()])},methods:{async fetchObject(){this.loading=!0,this.error=null;try{const e={blocks:"/blocks",parkings:"/parkings",villages:"/villages",plots:"/plots","commercial-blocks":"/commercial-blocks","commercial-premises":"/commercial-premises"}[this.objectType]||"/blocks",i=await f(`${e}/${this.objectId}`),d=await i.json();i.ok?(this.object=d.data||d,this.populateFormData(this.object)):this.error=d.message||"Ошибка при загрузке объекта"}catch(s){console.error("Error fetching object:",s),this.error="Ошибка при загрузке объекта"}finally{this.loading=!1}},populateFormData(s){this.formData={name:s.name||"",address:s.address||"",city_id:s.city?.id||null,builder_id:s.builder?.id||null,guid:s.guid||"",external_id:s.external_id||"",latitude:s.coordinates?.latitude||null,longitude:s.coordinates?.longitude||null,min_price:s.prices?.min||null,max_price:s.prices?.max||null,apartments_count:s.stats?.apartments_count||null,view_apartments_count:s.stats?.view_apartments_count||null,exclusive_apartments_count:s.stats?.exclusive_apartments_count||null,status:s.status||null,data_source:s.data_source||"parser",is_active:s.is_active??!0,is_suite:s.is_suite??!1,is_exclusive:s.is_exclusive??!1,is_marked:s.is_marked??!1,deadline:s.deadline||"",deadline_date:s.deadline_date?new Date(s.deadline_date).toISOString().split("T")[0]:"",finishing:s.finishing||""},this.originalData=JSON.parse(JSON.stringify(this.formData))},async fetchCities(){try{const e=await(await f("/regions")).json();if(e.data){const i=[];e.data.forEach(d=>{d.cities&&i.push(...d.cities)}),this.cities=i}}catch(s){console.error("Error fetching cities:",s)}},async fetchBuilders(){try{const e=await(await f("/builders")).json();e.data&&(this.builders=Array.isArray(e.data)?e.data:[])}catch(s){console.error("Error fetching builders:",s)}},async saveObject(){if(this.hasChanges){this.saving=!0,this.error=null;try{const e={blocks:"/blocks",parkings:"/parkings",villages:"/villages",plots:"/plots","commercial-blocks":"/commercial-blocks","commercial-premises":"/commercial-premises"}[this.objectType]||"/blocks",i={...this.formData};Object.keys(i).forEach(u=>{(i[u]===null||i[u]==="")&&delete i[u]});const d=await k(`${e}/${this.objectId}`,i),t=await d.json();d.ok?(alert("Объект успешно обновлен"),this.originalData=JSON.parse(JSON.stringify(this.formData)),await this.fetchObject()):(this.error=t.message||"Ошибка при сохранении объекта",alert(this.error))}catch(s){console.error("Error saving object:",s),this.error="Ошибка при сохранении объекта",alert(this.error)}finally{this.saving=!1}}},goToView(){this.$router.push({name:"admin.parser.object.view",params:{type:this.objectType,id:this.objectId}})}}},_={class:"parser-object-edit space-y-6"},V={class:"flex items-center justify-between mb-6"},h={class:"text-muted-foreground mt-1"},U={class:"flex gap-2"},O=["disabled"],j={key:0,class:"flex items-center justify-center py-12"},C={key:1,class:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg"},S={class:"text-destructive"},T={key:2,class:"space-y-6"},E={class:"bg-card rounded-lg border border-border p-6"},N={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},I=["value"],B=["value"],J={class:"bg-card rounded-lg border border-border p-6"},F={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},M={class:"bg-card rounded-lg border border-border p-6"},P={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},L={class:"text-xs text-muted-foreground mt-1"},q={class:"text-xs text-muted-foreground mt-1"},A={class:"bg-card rounded-lg border border-border p-6"},G={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},R={class:"bg-card rounded-lg border border-border p-6"},z={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},H={class:"flex items-center gap-2"},K={class:"flex items-center gap-2"},Q={class:"flex items-center gap-2"},W={class:"flex items-center gap-2"},X={class:"bg-card rounded-lg border border-border p-6"},Y={class:"grid grid-cols-1 md:grid-cols-2 gap-4"};function Z(s,e,i,d,t,u){return m(),a("div",_,[o("div",V,[o("div",null,[o("button",{onClick:e[0]||(e[0]=r=>s.$router.go(-1)),class:"mb-2 text-sm text-muted-foreground hover:text-foreground flex items-center gap-2"},[...e[25]||(e[25]=[o("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1),y(" Назад ",-1)])]),e[26]||(e[26]=o("h1",{class:"text-3xl font-semibold text-foreground"},"Редактирование объекта",-1)),o("p",h,g(t.object?.name||"Загрузка..."),1)]),o("div",U,[o("button",{onClick:e[1]||(e[1]=(...r)=>u.goToView&&u.goToView(...r)),class:"h-11 px-6 bg-muted hover:bg-muted/80 text-foreground rounded-lg transition-colors"}," Просмотр "),o("button",{onClick:e[2]||(e[2]=(...r)=>u.saveObject&&u.saveObject(...r)),disabled:t.saving||!u.hasChanges,class:"h-11 px-6 bg-green-500 hover:bg-green-600 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},g(t.saving?"Сохранение...":"Сохранить"),9,O)])]),t.loading?(m(),a("div",j,[...e[27]||(e[27]=[o("p",{class:"text-muted-foreground"},"Загрузка объекта...",-1)])])):c("",!0),t.error?(m(),a("div",C,[o("p",S,g(t.error),1)])):c("",!0),!t.loading&&t.object?(m(),a("div",T,[o("div",E,[e[36]||(e[36]=o("h2",{class:"text-xl font-semibold text-foreground mb-4"},"Основная информация",-1)),o("div",N,[o("div",null,[e[28]||(e[28]=o("label",{class:"block text-sm font-medium text-foreground mb-2"},"Название *",-1)),n(o("input",{"onUpdate:modelValue":e[3]||(e[3]=r=>t.formData.name=r),type:"text",class:"w-full h-10 px-3 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-ring",required:""},null,512),[[l,t.formData.name]])]),o("div",null,[e[29]||(e[29]=o("label",{class:"block text-sm font-medium text-foreground mb-2"},"Адрес",-1)),n(o("input",{"onUpdate:modelValue":e[4]||(e[4]=r=>t.formData.address=r),type:"text",class:"w-full h-10 px-3 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-ring"},null,512),[[l,t.formData.address]])]),o("div",null,[e[31]||(e[31]=o("label",{class:"block text-sm font-medium text-foreground mb-2"},"Город",-1)),n(o("select",{"onUpdate:modelValue":e[5]||(e[5]=r=>t.formData.city_id=r),class:"w-full h-10 px-3 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-ring"},[e[30]||(e[30]=o("option",{value:null},"Выберите город",-1)),(m(!0),a(x,null,v(t.cities,r=>(m(),a("option",{key:r.id,value:r.id},g(r.name),9,I))),128))],512),[[p,t.formData.city_id]])]),o("div",null,[e[33]||(e[33]=o("label",{class:"block text-sm font-medium text-foreground mb-2"},"Застройщик",-1)),n(o("select",{"onUpdate:modelValue":e[6]||(e[6]=r=>t.formData.builder_id=r),class:"w-full h-10 px-3 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-ring"},[e[32]||(e[32]=o("option",{value:null},"Выберите застройщика",-1)),(m(!0),a(x,null,v(t.builders,r=>(m(),a("option",{key:r.id,value:r.id},g(r.name),9,B))),128))],512),[[p,t.formData.builder_id]])]),o("div",null,[e[34]||(e[34]=o("label",{class:"block text-sm font-medium text-foreground mb-2"},"GUID",-1)),n(o("input",{"onUpdate:modelValue":e[7]||(e[7]=r=>t.formData.guid=r),type:"text",class:"w-full h-10 px-3 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-ring"},null,512),[[l,t.formData.guid]])]),o("div",null,[e[35]||(e[35]=o("label",{class:"block text-sm font-medium text-foreground mb-2"},"External ID",-1)),n(o("input",{"onUpdate:modelValue":e[8]||(e[8]=r=>t.formData.external_id=r),type:"text",class:"w-full h-10 px-3 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-ring"},null,512),[[l,t.formData.external_id]])])])]),o("div",J,[e[39]||(e[39]=o("h2",{class:"text-xl font-semibold text-foreground mb-4"},"Координаты",-1)),o("div",F,[o("div",null,[e[37]||(e[37]=o("label",{class:"block text-sm font-medium text-foreground mb-2"},"Широта",-1)),n(o("input",{"onUpdate:modelValue":e[9]||(e[9]=r=>t.formData.latitude=r),type:"number",step:"0.000001",class:"w-full h-10 px-3 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-ring"},null,512),[[l,t.formData.latitude,void 0,{number:!0}]])]),o("div",null,[e[38]||(e[38]=o("label",{class:"block text-sm font-medium text-foreground mb-2"},"Долгота",-1)),n(o("input",{"onUpdate:modelValue":e[10]||(e[10]=r=>t.formData.longitude=r),type:"number",step:"0.000001",class:"w-full h-10 px-3 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-ring"},null,512),[[l,t.formData.longitude,void 0,{number:!0}]])])])]),o("div",M,[e[42]||(e[42]=o("h2",{class:"text-xl font-semibold text-foreground mb-4"},"Цены",-1)),o("div",P,[o("div",null,[e[40]||(e[40]=o("label",{class:"block text-sm font-medium text-foreground mb-2"},"Минимальная цена (копейки)",-1)),n(o("input",{"onUpdate:modelValue":e[11]||(e[11]=r=>t.formData.min_price=r),type:"number",min:"0",class:"w-full h-10 px-3 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-ring"},null,512),[[l,t.formData.min_price,void 0,{number:!0}]]),o("p",L,g(t.formData.min_price?(t.formData.min_price/100).toLocaleString("ru-RU")+" ₽":""),1)]),o("div",null,[e[41]||(e[41]=o("label",{class:"block text-sm font-medium text-foreground mb-2"},"Максимальная цена (копейки)",-1)),n(o("input",{"onUpdate:modelValue":e[12]||(e[12]=r=>t.formData.max_price=r),type:"number",min:"0",class:"w-full h-10 px-3 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-ring"},null,512),[[l,t.formData.max_price,void 0,{number:!0}]]),o("p",q,g(t.formData.max_price?(t.formData.max_price/100).toLocaleString("ru-RU")+" ₽":""),1)])])]),o("div",A,[e[46]||(e[46]=o("h2",{class:"text-xl font-semibold text-foreground mb-4"},"Статистика",-1)),o("div",G,[o("div",null,[e[43]||(e[43]=o("label",{class:"block text-sm font-medium text-foreground mb-2"},"Всего квартир",-1)),n(o("input",{"onUpdate:modelValue":e[13]||(e[13]=r=>t.formData.apartments_count=r),type:"number",min:"0",class:"w-full h-10 px-3 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-ring"},null,512),[[l,t.formData.apartments_count,void 0,{number:!0}]])]),o("div",null,[e[44]||(e[44]=o("label",{class:"block text-sm font-medium text-foreground mb-2"},"На просмотр",-1)),n(o("input",{"onUpdate:modelValue":e[14]||(e[14]=r=>t.formData.view_apartments_count=r),type:"number",min:"0",class:"w-full h-10 px-3 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-ring"},null,512),[[l,t.formData.view_apartments_count,void 0,{number:!0}]])]),o("div",null,[e[45]||(e[45]=o("label",{class:"block text-sm font-medium text-foreground mb-2"},"Эксклюзивных",-1)),n(o("input",{"onUpdate:modelValue":e[15]||(e[15]=r=>t.formData.exclusive_apartments_count=r),type:"number",min:"0",class:"w-full h-10 px-3 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-ring"},null,512),[[l,t.formData.exclusive_apartments_count,void 0,{number:!0}]])])])]),o("div",R,[e[54]||(e[54]=o("h2",{class:"text-xl font-semibold text-foreground mb-4"},"Статусы",-1)),o("div",z,[o("div",null,[e[47]||(e[47]=o("label",{class:"block text-sm font-medium text-foreground mb-2"},"Статус",-1)),n(o("input",{"onUpdate:modelValue":e[16]||(e[16]=r=>t.formData.status=r),type:"number",class:"w-full h-10 px-3 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-ring"},null,512),[[l,t.formData.status,void 0,{number:!0}]])]),o("div",null,[e[49]||(e[49]=o("label",{class:"block text-sm font-medium text-foreground mb-2"},"Источник данных",-1)),n(o("select",{"onUpdate:modelValue":e[17]||(e[17]=r=>t.formData.data_source=r),class:"w-full h-10 px-3 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-ring"},[...e[48]||(e[48]=[o("option",{value:"parser"},"Парсер",-1),o("option",{value:"manual"},"Вручную",-1),o("option",{value:"feed"},"Feed",-1),o("option",{value:"import"},"Импорт",-1)])],512),[[p,t.formData.data_source]])]),o("div",H,[n(o("input",{"onUpdate:modelValue":e[18]||(e[18]=r=>t.formData.is_active=r),type:"checkbox",class:"w-5 h-5 rounded border-border text-accent focus:ring-accent/20"},null,512),[[b,t.formData.is_active]]),e[50]||(e[50]=o("label",{class:"text-sm font-medium text-foreground"},"Активен",-1))]),o("div",K,[n(o("input",{"onUpdate:modelValue":e[19]||(e[19]=r=>t.formData.is_suite=r),type:"checkbox",class:"w-5 h-5 rounded border-border text-accent focus:ring-accent/20"},null,512),[[b,t.formData.is_suite]]),e[51]||(e[51]=o("label",{class:"text-sm font-medium text-foreground"},"Сьют",-1))]),o("div",Q,[n(o("input",{"onUpdate:modelValue":e[20]||(e[20]=r=>t.formData.is_exclusive=r),type:"checkbox",class:"w-5 h-5 rounded border-border text-accent focus:ring-accent/20"},null,512),[[b,t.formData.is_exclusive]]),e[52]||(e[52]=o("label",{class:"text-sm font-medium text-foreground"},"Эксклюзив",-1))]),o("div",W,[n(o("input",{"onUpdate:modelValue":e[21]||(e[21]=r=>t.formData.is_marked=r),type:"checkbox",class:"w-5 h-5 rounded border-border text-accent focus:ring-accent/20"},null,512),[[b,t.formData.is_marked]]),e[53]||(e[53]=o("label",{class:"text-sm font-medium text-foreground"},"Помечен",-1))])])]),o("div",X,[e[58]||(e[58]=o("h2",{class:"text-xl font-semibold text-foreground mb-4"},"Сроки",-1)),o("div",Y,[o("div",null,[e[55]||(e[55]=o("label",{class:"block text-sm font-medium text-foreground mb-2"},"Срок сдачи",-1)),n(o("input",{"onUpdate:modelValue":e[22]||(e[22]=r=>t.formData.deadline=r),type:"text",class:"w-full h-10 px-3 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-ring"},null,512),[[l,t.formData.deadline]])]),o("div",null,[e[56]||(e[56]=o("label",{class:"block text-sm font-medium text-foreground mb-2"},"Дата сдачи",-1)),n(o("input",{"onUpdate:modelValue":e[23]||(e[23]=r=>t.formData.deadline_date=r),type:"date",class:"w-full h-10 px-3 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-ring"},null,512),[[l,t.formData.deadline_date]])]),o("div",null,[e[57]||(e[57]=o("label",{class:"block text-sm font-medium text-foreground mb-2"},"Отделка",-1)),n(o("input",{"onUpdate:modelValue":e[24]||(e[24]=r=>t.formData.finishing=r),type:"text",class:"w-full h-10 px-3 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-ring"},null,512),[[l,t.formData.finishing]])])])])])):c("",!0)])}const oe=D(w,[["render",Z]]);export{oe as default};
