import{_ as L,c as d,a as e,b as _,d as y,I as F,F as B,q as I,v as S,t as a,r as n,k as j,j as x,o as i}from"./admin-C3IZ-4yT.js";import{S as h}from"./sweetalert2.esm.all-C0u8rGqG.js";const U={name:"Logs",setup(){const g=n(!1),o=n(!1),r=n(null),t=n([]),c=n("laravel.log"),m=n(500),s=n(""),f=n({}),p=n(""),v=()=>({Authorization:`Bearer ${localStorage.getItem("token")}`,Accept:"application/json"}),w=async()=>{try{const l=await x.get("/api/logs/files",{headers:v()});l.data.files&&(t.value=l.data.files,t.value.length>0&&!t.value.includes(c.value)&&(c.value=t.value[0]))}catch(l){console.error("Error fetching log files:",l),r.value="Ошибка при загрузке списка файлов логов"}},b=async()=>{g.value=!0,r.value=null;try{const l=await x.get("/api/logs",{params:{file:c.value,lines:m.value},headers:v()});l.data.error?(r.value=l.data.error,s.value="",f.value={}):(s.value=l.data.content||"",f.value={file:l.data.file,file_size_formatted:l.data.file_size_formatted,lines_count:l.data.lines_count},p.value=new Date().toLocaleString("ru-RU"))}catch(l){r.value=l.response?.data?.error||"Ошибка при загрузке логов",console.error("Error loading logs:",l)}finally{g.value=!1}},k=async()=>{if((await h.fire({title:"Очистить логи?",text:`Вы уверены, что хотите очистить файл "${c.value}"? Это действие нельзя отменить.`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#ef4444",cancelButtonColor:"#6b7280",confirmButtonText:"Да, очистить",cancelButtonText:"Отмена"})).isConfirmed){o.value=!0,r.value=null;try{const u=await x.post("/api/logs/clear",{file:c.value},{headers:v()});u.data.success?(await h.fire({title:"Успешно",text:"Лог-файл успешно очищен",icon:"success",timer:2e3,showConfirmButton:!1}),await b()):r.value=u.data.error||"Ошибка при очистке логов"}catch(u){r.value=u.response?.data?.error||"Ошибка при очистке логов",console.error("Error clearing logs:",u)}finally{o.value=!1}}},C=()=>{s.value="",f.value={}};return j(async()=>{await w(),await b()}),{loading:g,clearing:o,error:r,logFiles:t,selectedLogFile:c,linesCount:m,logContent:s,logInfo:f,lastUpdate:p,loadLogs:b,clearLogs:k,handleLogFileChange:C}}},z={class:"logs-page space-y-6"},E={class:"bg-card rounded-lg border border-border p-4"},V={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},A={class:"md:col-span-2"},D=["value"],M={class:"flex items-end gap-2"},T=["disabled"],N=["disabled"],q={key:0,class:"bg-card rounded-lg border border-border p-4"},H={class:"flex flex-wrap gap-6 text-sm"},R={class:"ml-2 font-medium"},G={class:"ml-2 font-medium"},J={class:"ml-2 font-medium"},K={class:"ml-2 font-medium"},O={key:1,class:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg"},P={class:"text-destructive"},Q={class:"bg-card rounded-lg border border-border"},W={class:"p-4"},X={key:0,class:"flex items-center justify-center py-12"},Y={key:1,class:"flex items-center justify-center py-12"},Z={key:2,class:"bg-[#1e1e1e] text-[#d4d4d4] p-4 rounded overflow-x-auto text-xs font-mono leading-relaxed whitespace-pre-wrap break-words",style:{"max-height":"70vh","overflow-y":"auto"}};function $(g,o,r,t,c,m){return i(),d("div",z,[o[14]||(o[14]=e("div",{class:"flex items-center justify-between"},[e("div",null,[e("h1",{class:"text-3xl font-semibold text-foreground"},"Логи системы"),e("p",{class:"text-muted-foreground mt-1"},"Просмотр и управление логами приложения")])],-1)),e("div",E,[e("div",V,[e("div",A,[o[5]||(o[5]=e("label",{class:"block text-sm font-medium mb-2"},"Файл лога:",-1)),y(e("select",{"onUpdate:modelValue":o[0]||(o[0]=s=>t.selectedLogFile=s),onChange:o[1]||(o[1]=(...s)=>t.handleLogFileChange&&t.handleLogFileChange(...s)),class:"w-full h-10 px-3 border border-border rounded bg-background text-sm"},[(i(!0),d(B,null,I(t.logFiles,s=>(i(),d("option",{key:s,value:s},a(s),9,D))),128))],544),[[F,t.selectedLogFile]])]),e("div",null,[o[6]||(o[6]=e("label",{class:"block text-sm font-medium mb-2"},"Строк:",-1)),y(e("input",{type:"number","onUpdate:modelValue":o[2]||(o[2]=s=>t.linesCount=s),min:"100",max:"5000",step:"100",class:"w-full h-10 px-3 border border-border rounded bg-background text-sm"},null,512),[[S,t.linesCount,void 0,{number:!0}]])]),e("div",M,[e("button",{onClick:o[3]||(o[3]=(...s)=>t.loadLogs&&t.loadLogs(...s)),disabled:t.loading,class:"flex-1 h-10 px-4 bg-primary text-primary-foreground rounded hover:bg-primary/90 disabled:opacity-50 disabled:cursor-not-allowed text-sm font-medium"},a(t.loading?"Загрузка...":"Обновить"),9,T),e("button",{onClick:o[4]||(o[4]=(...s)=>t.clearLogs&&t.clearLogs(...s)),disabled:t.clearing,class:"flex-1 h-10 px-4 bg-destructive text-destructive-foreground rounded hover:bg-destructive/90 disabled:opacity-50 disabled:cursor-not-allowed text-sm font-medium"},a(t.clearing?"Очистка...":"Очистить"),9,N)])])]),t.logInfo.file?(i(),d("div",q,[e("div",H,[e("div",null,[o[7]||(o[7]=e("span",{class:"text-muted-foreground"},"Файл:",-1)),e("span",R,a(t.logInfo.file),1)]),e("div",null,[o[8]||(o[8]=e("span",{class:"text-muted-foreground"},"Размер:",-1)),e("span",G,a(t.logInfo.file_size_formatted),1)]),e("div",null,[o[9]||(o[9]=e("span",{class:"text-muted-foreground"},"Строк:",-1)),e("span",J,a(t.logInfo.lines_count),1)]),e("div",null,[o[10]||(o[10]=e("span",{class:"text-muted-foreground"},"Обновлено:",-1)),e("span",K,a(t.lastUpdate),1)])])])):_("",!0),t.error?(i(),d("div",O,[e("p",P,a(t.error),1)])):_("",!0),e("div",Q,[o[13]||(o[13]=e("div",{class:"p-4 border-b border-border"},[e("h2",{class:"text-lg font-semibold"},"Содержимое лога")],-1)),e("div",W,[t.loading&&!t.logContent?(i(),d("div",X,[...o[11]||(o[11]=[e("p",{class:"text-muted-foreground"},"Загрузка логов...",-1)])])):!t.logContent&&!t.loading?(i(),d("div",Y,[...o[12]||(o[12]=[e("p",{class:"text-muted-foreground"},'Выберите файл лога и нажмите "Обновить"',-1)])])):(i(),d("pre",Z,a(t.logContent),1))])])])}const te=L(U,[["render",$],["__scopeId","data-v-bc911cce"]]);export{te as default};
