import{_ as O,c,a as t,b as h,t as g,F as x,q as k,r as f,m as A,k as T,o as l}from"./admin-C3IZ-4yT.js";import{c as V,b as w}from"./api-BACpyIk9.js";import{S as y}from"./sweetalert2.esm.all-C0u8rGqG.js";const D={name:"Regions",setup(){const p=f(!1),i=f(!1),v=f(null),e=f([]),b=f({}),a=f({cities:{},regions:{}}),n=A(()=>Object.keys(a.value.cities).length>0||Object.keys(a.value.regions).length>0),d=s=>!s.cities||s.cities.length===0?0:s.cities.filter(r=>{const o=r.id;return a.value.cities[o]!==void 0?a.value.cities[o]:r.is_active}).length,m=async()=>{p.value=!0,v.value=null;try{const s=await V("/regions");if(!s.ok)throw new Error("Ошибка загрузки регионов");const r=await s.json();e.value=r.data||[],e.value.forEach(o=>{b.value[o.id]=!0})}catch(s){v.value=s.message||"Ошибка загрузки регионов"}finally{p.value=!1}},C=(s,r)=>{a.value.regions[s]=r;const o=e.value.find(u=>u.id===s);o&&(o.is_active=r)},j=(s,r,o)=>{a.value.cities[r]=o;const u=e.value.find(_=>_.id===s);if(u&&u.cities){const _=u.cities.find(E=>E.id===r);_&&(_.is_active=o)}},R=s=>{b.value[s]=!b.value[s]},B=async()=>{i.value=!0,v.value=null;try{if(Object.keys(a.value.cities).length>0){const s=Object.entries(a.value.cities).map(([o,u])=>({id:parseInt(o),is_active:u})),r=await w("/regions/cities/bulk-update",{cities:s});if(!r.ok){const o=await r.json();throw new Error(o.message||"Ошибка обновления городов")}}if(Object.keys(a.value.regions).length>0){const s=Object.entries(a.value.regions).map(([o,u])=>({id:parseInt(o),is_active:u})),r=await w("/regions/regions/bulk-update",{regions:s});if(!r.ok){const o=await r.json();throw new Error(o.message||"Ошибка обновления регионов")}}a.value={cities:{},regions:{}},await y.fire({title:"Изменения сохранены",icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"}),await m()}catch(s){v.value=s.message||"Ошибка сохранения изменений",y.fire({title:"Ошибка",text:s.message||"Ошибка сохранения изменений",icon:"error",confirmButtonText:"ОК"})}finally{i.value=!1}};return T(()=>{m()}),{loading:p,saving:i,error:v,regions:e,expandedRegions:b,changes:a,hasChanges:n,getActiveCitiesCount:d,toggleRegion:C,toggleCity:j,toggleRegionExpand:R,saveAll:B}}},M={class:"regions-page space-y-6"},S={class:"flex items-center justify-between mb-6"},z=["disabled"],F={key:0,xmlns:"http://www.w3.org/2000/svg",class:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},H={key:1,class:"animate-spin h-5 w-5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},N={key:0,class:"flex items-center justify-center py-12"},U={key:1,class:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg"},q={class:"text-destructive"},G={key:2,class:"bg-card rounded-lg border border-border"},I={class:"p-6 space-y-6"},L={class:"flex items-center justify-between mb-4"},P={class:"flex items-center gap-3"},J={class:"flex items-center gap-2 cursor-pointer"},K=["checked","onChange"],Q={class:"text-lg font-semibold text-foreground"},W={class:"flex items-center gap-4"},X={class:"text-sm text-muted-foreground"},Y=["onClick"],Z={key:0,class:"pl-8 space-y-2"},$={class:"flex items-center gap-2 cursor-pointer flex-1"},ee=["checked","onChange"],te={class:"text-sm text-foreground"},se={key:0,class:"text-sm text-muted-foreground pl-4"},oe={key:3,class:"bg-card rounded-lg border border-border p-12 text-center"};function ne(p,i,v,e,b,a){return l(),c("div",M,[t("div",S,[i[3]||(i[3]=t("div",null,[t("h1",{class:"text-3xl font-semibold text-foreground"},"Регионы"),t("p",{class:"text-muted-foreground mt-1"},"Управление доступными регионами городов TrendAgent")],-1)),t("button",{onClick:i[0]||(i[0]=(...n)=>e.saveAll&&e.saveAll(...n)),disabled:e.saving||!e.hasChanges,class:"h-11 px-6 bg-accent/10 backdrop-blur-xl text-accent border border-accent/40 hover:bg-accent/20 rounded-2xl shadow-lg shadow-accent/10 inline-flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed transition-all"},[e.saving?(l(),c("svg",H,[...i[2]||(i[2]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):(l(),c("svg",F,[...i[1]||(i[1]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3-3m0 0l-3 3m3-3v12"},null,-1)])])),t("span",null,g(e.saving?"Сохранение...":"Сохранить изменения"),1)],8,z)]),e.loading?(l(),c("div",N,[...i[4]||(i[4]=[t("p",{class:"text-muted-foreground"},"Загрузка регионов...",-1)])])):h("",!0),e.error?(l(),c("div",U,[t("p",q,g(e.error),1)])):h("",!0),!e.loading&&e.regions.length>0?(l(),c("div",G,[t("div",I,[(l(!0),c(x,null,k(e.regions,n=>(l(),c("div",{key:n.id,class:"border-b border-border last:border-b-0 pb-6 last:pb-0"},[t("div",L,[t("div",P,[t("label",J,[t("input",{type:"checkbox",checked:n.is_active,onChange:d=>e.toggleRegion(n.id,d.target.checked),class:"w-5 h-5 rounded border-border text-accent focus:ring-accent/20"},null,40,K),t("span",Q,g(n.name),1)])]),t("div",W,[t("span",X,g(e.getActiveCitiesCount(n))+" / "+g(n.cities?.length||0)+" городов ",1),t("button",{onClick:d=>e.toggleRegionExpand(n.id),class:"px-3 py-1 text-xs bg-muted/50 hover:bg-muted rounded transition-colors"},g(e.expandedRegions[n.id]?"▼ Свернуть":"▶ Развернуть"),9,Y)])]),e.expandedRegions[n.id]?(l(),c("div",Z,[(l(!0),c(x,null,k(n.cities,d=>(l(),c("div",{key:d.id,class:"flex items-center justify-between p-3 rounded-lg hover:bg-muted/30 transition-colors"},[t("label",$,[t("input",{type:"checkbox",checked:d.is_active,onChange:m=>e.toggleCity(n.id,d.id,m.target.checked),class:"w-4 h-4 rounded border-border text-accent focus:ring-accent/20"},null,40,ee),t("span",te,g(d.name),1)])]))),128)),!n.cities||n.cities.length===0?(l(),c("div",se," Города не найдены ")):h("",!0)])):h("",!0)]))),128))])])):h("",!0),!e.loading&&e.regions.length===0?(l(),c("div",oe,[...i[5]||(i[5]=[t("p",{class:"text-muted-foreground"},"Регионы не найдены",-1)])])):h("",!0)])}const ce=O(D,[["render",ne],["__scopeId","data-v-a1e03ae4"]]);export{ce as default};
