import{d as m,a as x,c as v}from"./api-BACpyIk9.js";import{_ as h,c as n,a as r,b as g,d as c,v as y,I as p,A as _,t as u,F as k,q as w,o as l,p as f,e as E}from"./admin-B3aLB-lk.js";const C={name:"ParserErrors",data(){return{loading:!1,error:null,errors:[],pagination:null,filters:{search:"",status:"",error_type:"",date_range:""},debounceTimer:null}},async mounted(){await this.fetchErrors()},methods:{async fetchErrors(i=1){this.loading=!0,this.error=null;try{const e={page:i,per_page:15,...this.filters};Object.keys(e).forEach(o=>{(e[o]===""||e[o]===null)&&delete e[o]});const d=await v("/parser-errors",e),a=await d.json();d.ok?(this.errors=a.data||[],this.pagination={current_page:a.current_page||1,last_page:a.last_page||1,from:a.from||0,to:a.to||0,total:a.total||0}):this.error=a.message||"Ошибка при загрузке ошибок"}catch(e){console.error("Error fetching errors:",e),this.error="Ошибка при загрузке ошибок"}finally{this.loading=!1}},debouncedFetchErrors(){clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>{this.fetchErrors()},500)},changePage(i){this.fetchErrors(i)},async updateErrorStatus(i,e){try{const d=await x(`/parser-errors/${i.id}`,{status:e});if(d.ok)await this.fetchErrors(this.pagination.current_page);else{const a=await d.json();alert(a.message||"Ошибка при обновлении статуса")}}catch(d){console.error("Error updating error status:",d),alert("Ошибка при обновлении статуса")}},async deleteError(i){if(confirm("Вы уверены, что хотите удалить эту ошибку?"))try{const e=await m(`/parser-errors/${i.id}`);if(e.ok)await this.fetchErrors(this.pagination.current_page);else{const d=await e.json();alert(d.message||"Ошибка при удалении ошибки")}}catch(e){console.error("Error deleting error:",e),alert("Ошибка при удалении ошибки")}},getStatusLabel(i){return{pending:"Ожидает",resolved:"Исправлено",ignored:"Игнорировано"}[i]||i}}},S={class:"parser-errors-page space-y-6"},j={class:"bg-card rounded-lg border border-border p-4 mb-6"},V={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},P={key:0,class:"flex items-center justify-center py-12"},T={key:1,class:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg"},U={class:"text-destructive"},L={key:2,class:"space-y-4"},F={class:"flex items-start justify-between mb-4"},N={class:"flex-1"},D={class:"flex items-center gap-3 mb-2"},B={class:"text-lg font-semibold text-foreground"},I={class:"text-sm text-foreground mb-2"},R={class:"text-xs text-muted-foreground mb-4"},A={key:0,class:"text-sm text-muted-foreground mb-2"},M={key:1,class:"text-sm text-muted-foreground"},O={class:"mt-2 p-2 bg-muted/30 rounded text-xs overflow-auto"},q={class:"flex gap-2 ml-4"},z=["onClick"],G=["onClick"],J=["onClick"],H={key:3,class:"bg-card rounded-lg border border-border p-12 text-center"},K={key:4,class:"flex items-center justify-between bg-card rounded-lg border border-border p-4"},Q={class:"text-sm text-muted-foreground"},W={class:"flex gap-2"},X=["disabled"],Y=["disabled"];function Z(i,e,d,a,o,s){return l(),n("div",S,[e[21]||(e[21]=r("div",{class:"flex items-center justify-between mb-6"},[r("div",null,[r("h1",{class:"text-3xl font-semibold text-foreground"},"Ошибки парсера"),r("p",{class:"text-muted-foreground mt-1"},"Просмотр и управление ошибками парсера")])],-1)),r("div",j,[r("div",V,[r("div",null,[e[10]||(e[10]=r("label",{class:"block text-sm font-medium text-foreground mb-2"},"Поиск",-1)),c(r("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>o.filters.search=t),onInput:e[1]||(e[1]=(...t)=>s.debouncedFetchErrors&&s.debouncedFetchErrors(...t)),type:"text",placeholder:"Сообщение или URL...",class:"w-full h-10 px-3 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-ring"},null,544),[[y,o.filters.search]])]),r("div",null,[e[12]||(e[12]=r("label",{class:"block text-sm font-medium text-foreground mb-2"},"Статус",-1)),c(r("select",{"onUpdate:modelValue":e[2]||(e[2]=t=>o.filters.status=t),onChange:e[3]||(e[3]=(...t)=>s.fetchErrors&&s.fetchErrors(...t)),class:"w-full h-10 px-3 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-ring"},[...e[11]||(e[11]=[r("option",{value:""},"Все статусы",-1),r("option",{value:"pending"},"Ожидает",-1),r("option",{value:"resolved"},"Исправлено",-1),r("option",{value:"ignored"},"Игнорировано",-1)])],544),[[p,o.filters.status]])]),r("div",null,[e[14]||(e[14]=r("label",{class:"block text-sm font-medium text-foreground mb-2"},"Тип ошибки",-1)),c(r("select",{"onUpdate:modelValue":e[4]||(e[4]=t=>o.filters.error_type=t),onChange:e[5]||(e[5]=(...t)=>s.fetchErrors&&s.fetchErrors(...t)),class:"w-full h-10 px-3 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-ring"},[...e[13]||(e[13]=[_('<option value="">Все типы</option><option value="api_error">API ошибка</option><option value="validation_error">Ошибка валидации</option><option value="parse_error">Ошибка парсинга</option><option value="network_error">Сетевая ошибка</option><option value="unknown">Неизвестная</option>',6)])],544),[[p,o.filters.error_type]])]),r("div",null,[e[16]||(e[16]=r("label",{class:"block text-sm font-medium text-foreground mb-2"},"Период",-1)),c(r("select",{"onUpdate:modelValue":e[6]||(e[6]=t=>o.filters.date_range=t),onChange:e[7]||(e[7]=(...t)=>s.fetchErrors&&s.fetchErrors(...t)),class:"w-full h-10 px-3 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-ring"},[...e[15]||(e[15]=[r("option",{value:""},"Все время",-1),r("option",{value:"today"},"Сегодня",-1),r("option",{value:"week"},"Неделя",-1),r("option",{value:"month"},"Месяц",-1)])],544),[[p,o.filters.date_range]])])])]),o.loading?(l(),n("div",P,[...e[17]||(e[17]=[r("p",{class:"text-muted-foreground"},"Загрузка ошибок...",-1)])])):g("",!0),o.error?(l(),n("div",T,[r("p",U,u(o.error),1)])):g("",!0),!o.loading&&o.errors.length>0?(l(),n("div",L,[(l(!0),n(k,null,w(o.errors,t=>(l(),n("div",{key:t.id,class:f(["bg-card rounded-lg border p-6",t.status==="resolved"?"border-green-500/20":"border-border"])},[r("div",F,[r("div",N,[r("div",D,[r("h3",B,u(t.error_type||"Неизвестная ошибка"),1),r("span",{class:f(["px-2 py-1 text-xs rounded-md",t.status==="resolved"?"bg-green-500/10 text-green-500":t.status==="ignored"?"bg-gray-500/10 text-gray-500":"bg-red-500/10 text-red-500"])},u(s.getStatusLabel(t.status)),3)]),r("p",I,u(t.message||"Нет сообщения"),1),r("p",R,u(new Date(t.created_at).toLocaleString("ru-RU")),1),t.url?(l(),n("div",A,[e[18]||(e[18]=r("strong",null,"URL:",-1)),E(" "+u(t.url),1)])):g("",!0),t.context?(l(),n("div",M,[r("details",null,[e[19]||(e[19]=r("summary",{class:"cursor-pointer hover:text-foreground"},"Детали",-1)),r("pre",O,u(JSON.stringify(t.context,null,2)),1)])])):g("",!0)]),r("div",q,[t.status==="pending"?(l(),n("button",{key:0,onClick:b=>s.updateErrorStatus(t,"resolved"),class:"px-3 py-1 text-xs bg-green-500 hover:bg-green-600 text-white rounded transition-colors"}," Исправить ",8,z)):g("",!0),t.status==="pending"?(l(),n("button",{key:1,onClick:b=>s.updateErrorStatus(t,"ignored"),class:"px-3 py-1 text-xs bg-gray-500 hover:bg-gray-600 text-white rounded transition-colors"}," Игнорировать ",8,G)):g("",!0),r("button",{onClick:b=>s.deleteError(t),class:"px-3 py-1 text-xs bg-red-500 hover:bg-red-600 text-white rounded transition-colors"}," Удалить ",8,J)])])],2))),128))])):g("",!0),!o.loading&&o.errors.length===0?(l(),n("div",H,[...e[20]||(e[20]=[r("p",{class:"text-muted-foreground"},"Ошибки не найдены",-1)])])):g("",!0),!o.loading&&o.pagination&&o.pagination.last_page>1?(l(),n("div",K,[r("div",Q," Показано "+u(o.pagination.from)+" - "+u(o.pagination.to)+" из "+u(o.pagination.total),1),r("div",W,[r("button",{onClick:e[8]||(e[8]=t=>s.changePage(o.pagination.current_page-1)),disabled:o.pagination.current_page===1,class:"px-4 py-2 text-sm border border-border rounded-lg hover:bg-muted/10 disabled:opacity-50 disabled:cursor-not-allowed"}," Назад ",8,X),r("button",{onClick:e[9]||(e[9]=t=>s.changePage(o.pagination.current_page+1)),disabled:o.pagination.current_page===o.pagination.last_page,class:"px-4 py-2 text-sm border border-border rounded-lg hover:bg-muted/10 disabled:opacity-50 disabled:cursor-not-allowed"}," Вперед ",8,Y)])])):g("",!0)])}const re=h(C,[["render",Z]]);export{re as default};
