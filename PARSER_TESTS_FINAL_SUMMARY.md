# üìä –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á–µ—Ç –æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –ø–∞—Ä—Å–µ—Ä–∞

**–î–∞—Ç–∞:** 28 –¥–µ–∫–∞–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è:** 2.0.0

---

## ‚úÖ –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

### 1. –°–∫—Ä–∏–ø—Ç –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

**–§–∞–π–ª:** `tests/run_parser_real_tests_simple.php`

–ü—Ä–æ—Å—Ç–æ–π —Å–∫—Ä–∏–ø—Ç, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–ø—É—Å–∫–∞–µ—Ç –∫–æ–º–∞–Ω–¥—ã –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ `exec()` –∏ —Å–æ–±–∏—Ä–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```bash
php tests/run_parser_real_tests_simple.php
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ env –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- –ü—Ä–æ—Å—Ç–æ–π –≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏
- –°–æ–∑–¥–∞–µ—Ç –ø–æ–¥—Ä–æ–±–Ω—ã–π –æ—Ç—á–µ—Ç

### 2. PHPUnit —Ç–µ—Å—Ç—ã

**–§–∞–π–ª:** `tests/Feature/ParserRealApiTest.php`

–ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–µ PHPUnit —Ç–µ—Å—Ç—ã –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```bash
php artisan test --filter ParserRealApiTest
```

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- –ù–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ `TREND_SSO_PHONE` –∏ `TREND_SSO_PASSWORD` –≤ `.env`
- –ó–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –≥–æ—Ä–æ–¥–∞ –≤ –ë–î

---

## üß™ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

- **–í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤:** 9
- **–í—ã–ø–æ–ª–Ω–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ (–∫–æ–º–∞–Ω–¥–∞ –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å):** 9 ‚úÖ
- **–û—à–∏–±–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã:** 0
- **–û—à–∏–±–æ–∫ API (—Ç—Ä–µ–±—É—é—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è):** –î–∞ (blocks API —Ç—Ä–µ–±—É–µ—Ç external_id)

### –ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

1. ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ blocks –¥–ª—è –ú–æ—Å–∫–≤—ã (–±–∞–∑–æ–≤—ã–π)
2. ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ blocks —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
3. ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ blocks —Å –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º
4. ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ blocks –¥–ª—è –°–ü–±
5. ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ commercial-blocks
6. ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ parkings
7. ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ —Å –±–æ–ª—å—à–∏–º –ª–∏–º–∏—Ç–æ–º
8. ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ —Å offset
9. ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ —Å –ø—Ä–æ–ø—É—Å–∫–æ–º –æ—à–∏–±–æ–∫

---

## ‚ö†Ô∏è –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞ 1: Blocks API —Ç—Ä–µ–±—É–µ—Ç MongoDB ObjectId

**–û—à–∏–±–∫–∞:**
```
"errors":{"city":{"param":"city","msg":"MongoID required","value":"msk"}}
```

**–†–µ—à–µ–Ω–∏–µ:**
- ‚úÖ –ö–æ–¥ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `external_id` (ObjectId) –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å
- ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è –∑–∞–ø–æ–ª–Ω–∏—Ç—å –ø–æ–ª–µ `external_id` –¥–ª—è –≥–æ—Ä–æ–¥–æ–≤

**–ö–∞–∫ –∏—Å–ø—Ä–∞–≤–∏—Ç—å:**
1. –ü–æ–ª—É—á–∏—Ç—å MongoDB ObjectId –¥–ª—è –≥–æ—Ä–æ–¥–æ–≤ –∏–∑ API TrendAgent
2. –û–±–Ω–æ–≤–∏—Ç—å –ø–æ–ª–µ `external_id` –≤ —Ç–∞–±–ª–∏—Ü–µ `cities`:
   ```sql
   UPDATE cities SET external_id = '507f1f77bcf86cd799439011' WHERE guid = 'msk';
   ```

---

## ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è** - —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ
2. **–ö–æ–º–∞–Ω–¥–∞ –ø–∞—Ä—Å–µ—Ä–∞** - –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** - –æ—à–∏–±–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
4. **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** - –≤—ã–≤–æ–¥–∏—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
5. **–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
6. **–ü–∞—Ä—Å–∏–Ω–≥ –¥—Ä—É–≥–∏—Ö —Ç–∏–ø–æ–≤** - parkings, commercial-blocks —Ä–∞–±–æ—Ç–∞—é—Ç

---

## üìã –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è blocks API:

1. **–ó–∞–ø–æ–ª–Ω–∏—Ç—å external_id –¥–ª—è –≥–æ—Ä–æ–¥–æ–≤:**
   - –ü–æ–ª—É—á–∏—Ç—å MongoDB ObjectId –∏–∑ API TrendAgent
   - –û–±–Ω–æ–≤–∏—Ç—å –ø–æ–ª–µ `external_id` –≤ –ë–î

2. **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞:**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥–∏–µ —Ç–∏–ø—ã –æ–±—ä–µ–∫—Ç–æ–≤ (parkings, commercial-blocks –∏ —Ç.–¥.)
   - –≠—Ç–∏ —Ç–∏–ø—ã —Ä–∞–±–æ—Ç–∞—é—Ç —Å GUID –≥–æ—Ä–æ–¥–æ–≤

### –î–ª—è —Ä–µ–≥—É–ª—è—Ä–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:

1. ‚úÖ –ü–∞—Ä—Å–µ—Ä –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
2. ‚úÖ –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
3. ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å external_id –¥–ª—è blocks API
4. ‚úÖ –û—Å—Ç–∞–ª—å–Ω—ã–µ —Ç–∏–ø—ã –æ–±—ä–µ–∫—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞—é—Ç –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

---

## üìÑ –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

1. `tests/run_parser_real_tests_simple.php` - —Å–∫—Ä–∏–ø—Ç –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
2. `tests/Feature/ParserRealApiTest.php` - PHPUnit —Ç–µ—Å—Ç—ã
3. `PARSER_REAL_API_TESTS_REPORT.md` - –ø–æ–¥—Ä–æ–±–Ω—ã–π –æ—Ç—á–µ—Ç
4. `PARSER_TESTS_FINAL_SUMMARY.md` - –∏—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á–µ—Ç (—ç—Ç–æ—Ç —Ñ–∞–π–ª)

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–¢–ï–°–¢–´ –°–û–ó–î–ê–ù–´ –ò –í–´–ü–û–õ–ù–ï–ù–´**

**–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:**
1. –ó–∞–ø–æ–ª–Ω–∏—Ç—å `external_id` –¥–ª—è –≥–æ—Ä–æ–¥–æ–≤ (–¥–ª—è blocks API)
2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∞—Ä—Å–µ—Ä –¥–ª—è —Ä–µ–≥—É–ª—è—Ä–Ω–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–∞–Ω–Ω—ã—Ö

