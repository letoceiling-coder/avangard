# –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—é –∏ —É–ª—É—á—à–µ–Ω–∏—é –ø–∞—Ä—Å–µ—Ä–∞ TrendAgent API

–î–æ–∫—É–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–≥–æ, –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ–≥–æ –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ–≥–æ –ø–∞—Ä—Å–µ—Ä–∞ TrendAgent.ru API.

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-12-28  
**–û—Å–Ω–æ–≤–∞:** –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã, –≤—Å–µ—Ö API endpoints –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä –¥–∞–Ω–Ω—ã—Ö

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ-—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏)
2. [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–ª–∞—Å—Å–æ–≤ –∏ —Å–µ—Ä–≤–∏—Å–æ–≤](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–∫–ª–∞—Å—Å–æ–≤-–∏-—Å–µ—Ä–≤–∏—Å–æ–≤)
3. [–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è](#–æ–±—Ä–∞–±–æ—Ç–∫–∞-–¥–∞–Ω–Ω—ã—Ö-–∏-—Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è)
4. [–†–∞–±–æ—Ç–∞ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏](#—Ä–∞–±–æ—Ç–∞-—Å-–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏)
5. [–ü–∞–≥–∏–Ω–∞—Ü–∏—è –∏ –º–∞—Å—Å–æ–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞](#–ø–∞–≥–∏–Ω–∞—Ü–∏—è-–∏-–º–∞—Å—Å–æ–≤–∞—è-–∑–∞–≥—Ä—É–∑–∫–∞)
6. [–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ](#–∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ)
7. [–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ](#–æ–±—Ä–∞–±–æ—Ç–∫–∞-–æ—à–∏–±–æ–∫-–∏-–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ)
8. [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
9. [–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å](#–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å)
10. [–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å](#–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### 1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω–∞ Strategy –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –æ–±—ä–µ–∫—Ç–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞:** –¢–µ–∫—É—â–∏–π –∫–æ–¥ –∏–º–µ–µ—Ç —É—Å–ª–æ–≤–Ω—É—é –ª–æ–≥–∏–∫—É –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –æ–±—ä–µ–∫—Ç–æ–≤ –≤ –æ–¥–Ω–æ–º –º–µ—Ç–æ–¥–µ.

**–†–µ—à–µ–Ω–∏–µ:** –°–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∫–ª–∞—Å—Å—ã-—Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ –æ–±—ä–µ–∫—Ç–∞:

```php
namespace App\Services\TrendParser\Strategies;

interface ParserStrategyInterface
{
    public function search(array $params): array;
    public function getEndpoint(): string;
    public function normalizeResponse(array $response): array;
    public function getDefaultParams(): array;
}

class ApartmentsParserStrategy implements ParserStrategyInterface
{
    public function search(array $params): array { /* ... */ }
    public function getEndpoint(): string {
        return 'https://api.trendagent.ru/v4_29/blocks/search/';
    }
    // ...
}

class ParkingsParserStrategy implements ParserStrategyInterface
{
    public function search(array $params): array { /* ... */ }
    public function getEndpoint(): string {
        return 'https://parkings.trendagent.ru/search/places/';
    }
    // ...
}

class HousesParserStrategy implements ParserStrategyInterface { /* ... */ }
class CommercialParserStrategy implements ParserStrategyInterface { /* ... */ }
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Ç–∏–ø—ã –æ–±—ä–µ–∫—Ç–æ–≤
- –ö–∞–∂–¥—ã–π –∫–ª–∞—Å—Å –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –æ–¥–∏–Ω —Ç–∏–ø
- –ü—Ä–æ—â–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å
- –°–æ–±–ª—é–¥–µ–Ω–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø–∞ Single Responsibility

### 2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Factory –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–π

```php
namespace App\Services\TrendParser\Factories;

class ParserStrategyFactory
{
    public static function create(string $objectType): ParserStrategyInterface
    {
        return match($objectType) {
            'apartments' => new ApartmentsParserStrategy(),
            'parking' => new ParkingsParserStrategy(),
            'plots', 'houses' => new HousesParserStrategy(),
            'commercial' => new CommercialParserStrategy(),
            default => throw new \InvalidArgumentException("Unknown object type: {$objectType}"),
        };
    }
}
```

### 3. –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –Ω–∞ —Å–ª–æ–∏

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Controllers (API endpoints)       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
               ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Parser Service (Orchestration)    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
               ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Strategy Classes (Parser logic)   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
               ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   ApiAuth Service (HTTP requests)   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
               ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Transformers (Data normalization) ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üîß –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–ª–∞—Å—Å–æ–≤ –∏ —Å–µ—Ä–≤–∏—Å–æ–≤

### –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫

```
app/Services/TrendParser/
‚îú‚îÄ‚îÄ Contracts/
‚îÇ   ‚îú‚îÄ‚îÄ ParserStrategyInterface.php
‚îÇ   ‚îî‚îÄ‚îÄ DataTransformerInterface.php
‚îú‚îÄ‚îÄ Strategies/
‚îÇ   ‚îú‚îÄ‚îÄ ApartmentsParserStrategy.php
‚îÇ   ‚îú‚îÄ‚îÄ ParkingsParserStrategy.php
‚îÇ   ‚îú‚îÄ‚îÄ HousesParserStrategy.php
‚îÇ   ‚îî‚îÄ‚îÄ CommercialParserStrategy.php
‚îú‚îÄ‚îÄ Transformers/
‚îÇ   ‚îú‚îÄ‚îÄ BlockTransformer.php
‚îÇ   ‚îú‚îÄ‚îÄ ParkingTransformer.php
‚îÇ   ‚îú‚îÄ‚îÄ VillageTransformer.php
‚îÇ   ‚îî‚îÄ‚îÄ CommercialTransformer.php
‚îú‚îÄ‚îÄ Factories/
‚îÇ   ‚îî‚îÄ‚îÄ ParserStrategyFactory.php
‚îú‚îÄ‚îÄ Builders/
‚îÇ   ‚îú‚îÄ‚îÄ QueryBuilder.php
‚îÇ   ‚îî‚îÄ‚îÄ UrlBuilder.php
‚îú‚îÄ‚îÄ Exceptions/
‚îÇ   ‚îú‚îÄ‚îÄ ParserException.php
‚îÇ   ‚îú‚îÄ‚îÄ AuthenticationException.php
‚îÇ   ‚îî‚îÄ‚îÄ DataTransformationException.php
‚îî‚îÄ‚îÄ TrendParserService.php
```

### –û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–∏—Å –ø–∞—Ä—Å–µ—Ä–∞

```php
namespace App\Services\TrendParser;

use App\Services\TrendParser\Factories\ParserStrategyFactory;
use App\Services\TrendParser\Contracts\ParserStrategyInterface;
use App\Services\TrendSsoApiAuth;

class TrendParserService
{
    private TrendSsoApiAuth $auth;
    private ?ParserStrategyInterface $strategy = null;

    public function __construct(TrendSsoApiAuth $auth)
    {
        $this->auth = $auth;
    }

    /**
     * –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –ø–∞—Ä—Å–∏–Ω–≥–∞
     */
    public function setStrategy(string $objectType): self
    {
        $this->strategy = ParserStrategyFactory::create($objectType);
        return $this;
    }

    /**
     * –ü–æ–∏—Å–∫ –æ–±—ä–µ–∫—Ç–æ–≤
     */
    public function search(array $params = []): array
    {
        if (!$this->strategy) {
            throw new \RuntimeException('Strategy not set. Call setStrategy() first.');
        }

        // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞
        if (!$this->auth->isAuthenticated()) {
            throw new AuthenticationException('Not authenticated');
        }

        // –û–±—ä–µ–¥–∏–Ω—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–º–∏
        $mergedParams = array_merge(
            $this->strategy->getDefaultParams(),
            $params
        );

        // –í—ã–ø–æ–ª–Ω—è–µ–º –∑–∞–ø—Ä–æ—Å —á–µ—Ä–µ–∑ —Å—Ç—Ä–∞—Ç–µ–≥–∏—é
        $response = $this->strategy->search($mergedParams);

        // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –æ—Ç–≤–µ—Ç
        return $this->strategy->normalizeResponse($response);
    }

    /**
     * –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π
     */
    public function getAllResults(array $params = [], ?callable $onPageCallback = null): \Generator
    {
        $offset = 0;
        $count = $params['count'] ?? 100;
        $hasMore = true;

        while ($hasMore) {
            $params['offset'] = $offset;
            $results = $this->search($params);

            if (empty($results['data'])) {
                break;
            }

            if ($onPageCallback) {
                $onPageCallback($results);
            }

            yield $results;

            $hasMore = $results['pagination']['has_more'] ?? false;
            $offset += $count;
        }
    }
}
```

---

## üîÑ –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Transformers –¥–ª—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö

**–ü—Ä–æ–±–ª–µ–º–∞:** –†–∞–∑–Ω—ã–µ —Ç–∏–ø—ã –æ–±—ä–µ–∫—Ç–æ–≤ –∏–º–µ—é—Ç —Ä–∞–∑–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –æ—Ç–≤–µ—Ç–æ–≤.

**–†–µ—à–µ–Ω–∏–µ:** –°–æ–∑–¥–∞—Ç—å —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–µ—Ä—ã –¥–ª—è –ø—Ä–∏–≤–µ–¥–µ–Ω–∏—è –∫ –µ–¥–∏–Ω–æ–º—É —Ñ–æ—Ä–º–∞—Ç—É:

```php
namespace App\Services\TrendParser\Transformers;

interface DataTransformerInterface
{
    public function transform(array $data): array;
    public function transformCollection(array $items): array;
}

class BlockTransformer implements DataTransformerInterface
{
    private ImageUrlBuilder $imageBuilder;

    public function __construct(ImageUrlBuilder $imageBuilder)
    {
        $this->imageBuilder = $imageBuilder;
    }

    public function transform(array $block): array
    {
        return [
            'id' => $block['_id'],
            'crm_id' => $block['crm_id'] ?? null,
            'name' => $block['name'],
            'guid' => $block['guid'],
            'address' => $this->transformAddress($block['address'] ?? []),
            'city' => $this->transformLocation($block['city'] ?? []),
            'region' => $this->transformLocation($block['region'] ?? []),
            'location' => $this->transformLocation($block['location'] ?? []),
            'builder' => $this->transformBuilder($block['builder'] ?? []),
            'coordinates' => [
                'latitude' => $block['latitude'] ?? null,
                'longitude' => $block['longitude'] ?? null,
            ],
            'subways' => $this->transformSubways($block['subways'] ?? []),
            'prices' => $this->transformPrices($block),
            'deadline' => $this->transformDeadline($block),
            'finishing' => $block['finishing'] ?? null,
            'images' => $this->transformImages($block['image'] ?? null),
            'stats' => [
                'apartments_count' => $block['apart_count'] ?? 0,
                'view_apartments_count' => $block['view_apart_count'] ?? 0,
                'exclusive_apartments_count' => $block['exclusive_apartments_count'] ?? 0,
            ],
            'metadata' => [
                'status' => $block['status'] ?? null,
                'is_exclusive' => $block['exclusive'] ?? false,
                'is_suite' => $block['is_suite'] ?? false,
                'marked' => $block['marked'] ?? false,
            ],
        ];
    }

    public function transformCollection(array $blocks): array
    {
        return array_map([$this, 'transform'], $blocks);
    }

    private function transformAddress(array $address): ?string
    {
        return !empty($address) ? implode(', ', $address) : null;
    }

    private function transformLocation(array $location): ?array
    {
        if (empty($location)) {
            return null;
        }

        return [
            'id' => $location['_id'] ?? null,
            'guid' => $location['guid'] ?? null,
            'name' => $location['name'] ?? null,
            'crm_id' => $location['crm_id'] ?? null,
        ];
    }

    private function transformBuilder(array $builder): ?array
    {
        return $this->transformLocation($builder); // –¢–∞–∫–∞—è –∂–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
    }

    private function transformSubways(array $subways): array
    {
        return array_map(function($subway) {
            return [
                'id' => $subway['_id'] ?? null,
                'name' => $subway['name'] ?? null,
                'guid' => $subway['guid'] ?? null,
                'line' => $subway['line'] ?? null,
                'line_number' => $subway['line_number'] ?? null,
                'color' => $subway['color'] ?? null,
                'distance' => [
                    'time' => $subway['distance_timing'] ?? null,
                    'type' => $subway['distance_type'] ?? null,
                    'type_id' => $subway['distance_type_id'] ?? null,
                ],
                'coordinates' => $this->extractCoordinates($subway['geometry'] ?? null),
            ];
        }, $subways);
    }

    private function transformPrices(array $block): array
    {
        return [
            'min' => $block['min_price'] ?? null,
            'max' => $block['max_price'] ?? null,
            'by_type' => $this->transformMinPrices($block['min_prices'] ?? []),
        ];
    }

    private function transformMinPrices(array $minPrices): array
    {
        return array_map(function($price) {
            return [
                'room_type_id' => $price['room'] ?? null,
                'room_type_name' => $price['rooms'] ?? null,
                'price' => $price['price'] ?? null,
            ];
        }, $minPrices);
    }

    private function transformDeadline(array $block): ?array
    {
        if (empty($block['deadline'])) {
            return null;
        }

        return [
            'text' => $block['deadline'],
            'details' => $this->transformDeadlineExt($block['deadline_ext'] ?? []),
        ];
    }

    private function transformDeadlineExt(array $deadlineExt): array
    {
        return array_map(function($item) {
            return [
                'deadline' => $item['deadline'] ?? null,
                'overdue_check' => $item['deadline_over_check'] ?? false,
            ];
        }, $deadlineExt);
    }

    private function transformImages(?array $image): ?array
    {
        if (empty($image)) {
            return null;
        }

        return [
            'id' => $image['_id'] ?? null,
            'file_name' => $image['file_name'] ?? null,
            'path' => $image['path'] ?? null,
            'url_thumbnail' => $this->imageBuilder->buildThumbnailUrl($image),
            'url_full' => $this->imageBuilder->buildFullUrl($image),
        ];
    }

    private function extractCoordinates(?array $geometry): ?array
    {
        if (empty($geometry) || $geometry['type'] !== 'Point') {
            return null;
        }

        $coords = $geometry['coordinates'] ?? [];
        return [
            'longitude' => $coords[0] ?? null,
            'latitude' => $coords[1] ?? null,
        ];
    }
}
```

### –ï–¥–∏–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞

–í—Å–µ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–µ—Ä—ã –¥–æ–ª–∂–Ω—ã –ø—Ä–∏–≤–æ–¥–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∫ –µ–¥–∏–Ω–æ–º—É —Ñ–æ—Ä–º–∞—Ç—É:

```php
[
    'id' => string,
    'type' => 'apartment' | 'parking' | 'house' | 'commercial',
    'name' => string,
    'address' => string,
    'location' => [
        'city' => [...],
        'region' => [...],
        'coordinates' => [...],
    ],
    'builder' => [...],
    'prices' => [...],
    'images' => [...],
    'metadata' => [...],
]
```

---

## üñºÔ∏è –†–∞–±–æ—Ç–∞ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏

### –û—Ç–¥–µ–ª—å–Ω—ã–π –∫–ª–∞—Å—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏

```php
namespace App\Services\TrendParser\Builders;

class ImageUrlBuilder
{
    private const CDN_BASE_URL = 'https://selcdn.trendagent.ru/images';

    /**
     * –ü–æ—Å—Ç—Ä–æ–∏—Ç—å URL –º–∏–Ω–∏–∞—Ç—é—Ä—ã
     */
    public function buildThumbnailUrl(array $image): ?string
    {
        if (empty($image['path']) || empty($image['file_name'])) {
            return null;
        }

        $path = $this->normalizePath($image['path']);
        $fileName = $image['file_name'];

        return sprintf(
            '%s/%s/m_%s',
            self::CDN_BASE_URL,
            $path,
            $fileName
        );
    }

    /**
     * –ü–æ—Å—Ç—Ä–æ–∏—Ç—å URL –ø–æ–ª–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
     */
    public function buildFullUrl(array $image): ?string
    {
        if (empty($image['path']) || empty($image['file_name'])) {
            return null;
        }

        $path = $this->normalizePath($image['path']);
        $fileName = $image['file_name'];

        return sprintf(
            '%s/%s/%s',
            self::CDN_BASE_URL,
            $path,
            $fileName
        );
    }

    /**
     * –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—É—Ç—å (—É–±—Ä–∞—Ç—å –ª–∏—à–Ω–∏–µ —Å–ª—ç—à–∏)
     */
    private function normalizePath(string $path): string
    {
        return trim($path, '/');
    }

    /**
     * –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –º–∞—Å—Å–∏–≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
     */
    public function transformImageArray(?array $images): array
    {
        if (empty($images)) {
            return [];
        }

        // –ï—Å–ª–∏ —ç—Ç–æ –æ–¥–∏–Ω –æ–±—ä–µ–∫—Ç, –¥–µ–ª–∞–µ–º –º–∞—Å—Å–∏–≤
        if (isset($images['file_name'])) {
            $images = [$images];
        }

        return array_map(function($image) {
            return [
                'id' => $image['_id'] ?? null,
                'file_name' => $image['file_name'] ?? null,
                'path' => $image['path'] ?? null,
                'url_thumbnail' => $this->buildThumbnailUrl($image),
                'url_full' => $this->buildFullUrl($image),
            ];
        }, $images);
    }
}
```

### –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

```php
namespace App\Services\TrendParser;

use Illuminate\Support\Facades\Storage;
use Illuminate\Support\Facades\Http;

class ImageDownloader
{
    /**
     * –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ
     */
    public function download(string $url, string $storagePath = 'trend_images'): ?string
    {
        try {
            $response = Http::timeout(30)->get($url);

            if (!$response->successful()) {
                return null;
            }

            $fileName = basename(parse_url($url, PHP_URL_PATH));
            $fullPath = "{$storagePath}/{$fileName}";

            Storage::disk('local')->put($fullPath, $response->body());

            return $fullPath;
        } catch (\Exception $e) {
            \Log::error('Failed to download image', [
                'url' => $url,
                'error' => $e->getMessage(),
            ]);
            return null;
        }
    }

    /**
     * –ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
     */
    public function downloadBatch(array $urls, string $storagePath = 'trend_images'): array
    {
        $results = [];
        foreach ($urls as $url) {
            $results[$url] = $this->download($url, $storagePath);
        }
        return $results;
    }
}
```

---

## üìÑ –ü–∞–≥–∏–Ω–∞—Ü–∏—è –∏ –º–∞—Å—Å–æ–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞

### –ö–ª–∞—Å—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π

```php
namespace App\Services\TrendParser;

class Paginator
{
    private int $count;
    private int $offset;
    private bool $hasMore;
    private int $total;

    public function __construct(int $count = 100, int $offset = 0)
    {
        $this->count = $count;
        $this->offset = $offset;
        $this->hasMore = true;
        $this->total = 0;
    }

    /**
     * –ü–æ–ª—É—á–∏—Ç—å —Å–ª–µ–¥—É—é—â–∏–π offset
     */
    public function next(): int
    {
        $this->offset += $this->count;
        return $this->offset;
    }

    /**
     * –û–±–Ω–æ–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–∞–≥–∏–Ω–∞—Ç–æ—Ä–∞ –∏–∑ –æ—Ç–≤–µ—Ç–∞ API
     */
    public function updateFromResponse(array $response): void
    {
        $returnedCount = count($response['data'] ?? []);
        $this->hasMore = $returnedCount >= $this->count;
        $this->total = $response['total'] ?? $this->total + $returnedCount;
    }

    /**
     * –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –µ—Å—Ç—å –ª–∏ –µ—â–µ –¥–∞–Ω–Ω—ã–µ
     */
    public function hasMore(): bool
    {
        return $this->hasMore;
    }

    /**
     * –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞
     */
    public function getParams(): array
    {
        return [
            'count' => $this->count,
            'offset' => $this->offset,
        ];
    }
}
```

### –ú–∞—Å—Å–æ–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫

```php
class TrendParserService
{
    /**
     * –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
     */
    public function getAllResultsSafe(
        array $params = [],
        ?callable $onProgress = null,
        int $maxRetries = 3
    ): \Generator {
        $paginator = new Paginator($params['count'] ?? 100);
        $retryCount = 0;

        while ($paginator->hasMore()) {
            try {
                $params = array_merge($params, $paginator->getParams());
                $results = $this->search($params);

                $paginator->updateFromResponse($results);
                
                if ($onProgress) {
                    $onProgress($results, $paginator);
                }

                yield $results;
                $retryCount = 0; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –ø—Ä–∏ —É—Å–ø–µ—Ö–µ

            } catch (\Exception $e) {
                $retryCount++;
                
                if ($retryCount >= $maxRetries) {
                    \Log::error('Max retries reached', [
                        'error' => $e->getMessage(),
                        'offset' => $paginator->getParams()['offset'],
                    ]);
                    throw $e;
                }

                // –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –ø–æ–≤—Ç–æ—Ä–æ–º
                sleep(pow(2, $retryCount)); // Exponential backoff: 2s, 4s, 8s
                continue;
            }
        }
    }
}
```

---

## üíæ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

```php
namespace App\Services\TrendParser;

use Illuminate\Support\Facades\Cache;

class TokenCache
{
    private const CACHE_PREFIX = 'trend_auth_token';
    private const TTL = 300; // 5 –º–∏–Ω—É—Ç (—Ç–æ–∫–µ–Ω—ã –æ–±—ã—á–Ω–æ –∂–∏–≤—É—Ç 5 –º–∏–Ω—É—Ç)

    public function get(string $key): ?string
    {
        return Cache::get($this->buildKey($key));
    }

    public function put(string $key, string $token, ?int $ttl = null): void
    {
        Cache::put(
            $this->buildKey($key),
            $token,
            $ttl ?? self::TTL
        );
    }

    public function forget(string $key): void
    {
        Cache::forget($this->buildKey($key));
    }

    private function buildKey(string $key): string
    {
        return self::CACHE_PREFIX . ':' . md5($key);
    }
}
```

### –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–≤

```php
class DirectoryCache
{
    private const CACHE_PREFIX = 'trend_directories';
    private const TTL = 3600; // 1 —á–∞—Å

    /**
     * –ü–æ–ª—É—á–∏—Ç—å —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –∏–∑ –∫—ç—à–∞ –∏–ª–∏ API
     */
    public function remember(string $type, callable $callback): array
    {
        $key = $this->buildKey($type);
        
        return Cache::remember($key, self::TTL, function() use ($callback) {
            return $callback();
        });
    }

    /**
     * –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–≤
     */
    public function clear(): void
    {
        Cache::flush(); // –ò–ª–∏ –±–æ–ª–µ–µ —Å–µ–ª–µ–∫—Ç–∏–≤–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞
    }

    private function buildKey(string $type): string
    {
        return self::CACHE_PREFIX . ':' . $type;
    }
}
```

---

## üö® –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ö–∞—Å—Ç–æ–º–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è

```php
namespace App\Services\TrendParser\Exceptions;

class ParserException extends \Exception
{
    private ?array $context;

    public function __construct(string $message, ?array $context = null, ?\Throwable $previous = null)
    {
        parent::__construct($message, 0, $previous);
        $this->context = $context;
    }

    public function getContext(): ?array
    {
        return $this->context;
    }
}

class AuthenticationException extends ParserException {}
class RateLimitException extends ParserException {}
class InvalidResponseException extends ParserException {}
```

### –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

```php
namespace App\Services\TrendParser;

use Illuminate\Support\Facades\Log;

class ParserLogger
{
    private const CHANNEL = 'trend_parser';

    public function logRequest(string $endpoint, array $params): void
    {
        Log::channel(self::CHANNEL)->info('API Request', [
            'endpoint' => $endpoint,
            'params' => $this->sanitizeParams($params),
        ]);
    }

    public function logResponse(string $endpoint, array $response): void
    {
        Log::channel(self::CHANNEL)->info('API Response', [
            'endpoint' => $endpoint,
            'results_count' => count($response['data'] ?? []),
            'status_code' => $response['status_code'] ?? null,
        ]);
    }

    public function logError(\Throwable $e, ?array $context = null): void
    {
        Log::channel(self::CHANNEL)->error('Parser Error', [
            'message' => $e->getMessage(),
            'class' => get_class($e),
            'context' => $context,
            'trace' => $e->getTraceAsString(),
        ]);
    }

    private function sanitizeParams(array $params): array
    {
        // –£–¥–∞–ª—è–µ–º —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
        unset($params['auth_token'], $params['password']);
        return $params;
    }
}
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–∞–Ω–∞–ª–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤ `config/logging.php`

```php
'channels' => [
    // ...
    'trend_parser' => [
        'driver' => 'daily',
        'path' => storage_path('logs/trend_parser.log'),
        'level' => env('LOG_LEVEL', 'debug'),
        'days' => 14,
    ],
],
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### Unit —Ç–µ—Å—Ç—ã –¥–ª—è —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–µ—Ä–æ–≤

```php
namespace Tests\Unit\Services\TrendParser\Transformers;

use App\Services\TrendParser\Transformers\BlockTransformer;
use App\Services\TrendParser\Builders\ImageUrlBuilder;
use Tests\TestCase;

class BlockTransformerTest extends TestCase
{
    private BlockTransformer $transformer;

    protected function setUp(): void
    {
        parent::setUp();
        $this->transformer = new BlockTransformer(new ImageUrlBuilder());
    }

    public function test_transform_basic_block(): void
    {
        $block = [
            '_id' => 'test_id',
            'name' => 'Test Block',
            'guid' => 'test-guid',
            'address' => ['Test Street 1'],
            'latitude' => 55.75,
            'longitude' => 37.61,
        ];

        $result = $this->transformer->transform($block);

        $this->assertEquals('test_id', $result['id']);
        $this->assertEquals('Test Block', $result['name']);
        $this->assertEquals('Test Street 1', $result['address']);
        $this->assertEquals(55.75, $result['coordinates']['latitude']);
        $this->assertEquals(37.61, $result['coordinates']['longitude']);
    }

    public function test_transform_with_images(): void
    {
        $block = [
            '_id' => 'test_id',
            'image' => [
                'path' => 'test/path',
                'file_name' => 'test.jpg',
            ],
        ];

        $result = $this->transformer->transform($block);

        $this->assertNotNull($result['images']);
        $this->assertStringContainsString('test.jpg', $result['images']['url_thumbnail']);
    }
}
```

### Feature —Ç–µ—Å—Ç—ã –¥–ª—è –ø–∞—Ä—Å–µ—Ä–∞

```php
namespace Tests\Feature\Services\TrendParser;

use App\Services\TrendParser\TrendParserService;
use App\Services\TrendSsoApiAuth;
use Tests\TestCase;
use Mockery;

class TrendParserServiceTest extends TestCase
{
    public function test_search_apartments(): void
    {
        $auth = Mockery::mock(TrendSsoApiAuth::class);
        $auth->shouldReceive('isAuthenticated')->andReturn(true);
        // ... –¥—Ä—É–≥–∏–µ –º–æ–∫–∏

        $parser = new TrendParserService($auth);
        $parser->setStrategy('apartments');

        // –¢–µ—Å—Ç–∏—Ä—É–µ–º –ª–æ–≥–∏–∫—É
    }
}
```

---

## ‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### 1. –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

–î–ª—è –º–∞—Å—Å–æ–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å async –∑–∞–ø—Ä–æ—Å—ã —á–µ—Ä–µ–∑ Guzzle:

```php
use GuzzleHttp\Promise;

class AsyncParser
{
    public function fetchMultiple(array $endpoints): array
    {
        $promises = [];
        
        foreach ($endpoints as $key => $url) {
            $promises[$key] = $this->client->getAsync($url);
        }

        $responses = Promise\Utils::settle($promises)->wait();

        $results = [];
        foreach ($responses as $key => $response) {
            if ($response['state'] === 'fulfilled') {
                $results[$key] = json_decode(
                    $response['value']->getBody()->getContents(),
                    true
                );
            }
        }

        return $results;
    }
}
```

### 2. Batch –æ–±—Ä–∞–±–æ—Ç–∫–∞

```php
class BatchProcessor
{
    public function processInBatches(
        array $items,
        callable $processor,
        int $batchSize = 50
    ): array {
        $batches = array_chunk($items, $batchSize);
        $results = [];

        foreach ($batches as $batch) {
            $batchResults = array_map($processor, $batch);
            $results = array_merge($results, $batchResults);
        }

        return $results;
    }
}
```

### 3. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ rate limiting

```php
class RateLimiter
{
    private int $requestsPerSecond;
    private float $lastRequestTime = 0;

    public function __construct(int $requestsPerSecond = 10)
    {
        $this->requestsPerSecond = $requestsPerSecond;
    }

    public function waitIfNeeded(): void
    {
        $minInterval = 1.0 / $this->requestsPerSecond;
        $timeSinceLastRequest = microtime(true) - $this->lastRequestTime;

        if ($timeSinceLastRequest < $minInterval) {
            usleep((int)(($minInterval - $timeSinceLastRequest) * 1000000));
        }

        $this->lastRequestTime = microtime(true);
    }
}
```

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### 1. –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

```php
namespace App\Services\TrendParser\Validators;

class RequestValidator
{
    public function validateSearchParams(array $params): array
    {
        $rules = [
            'count' => 'nullable|integer|min:1|max:100',
            'offset' => 'nullable|integer|min:0',
            'sort' => 'nullable|string|in:price,name,deadline',
            'sort_order' => 'nullable|string|in:asc,desc',
        ];

        $validator = \Validator::make($params, $rules);

        if ($validator->fails()) {
            throw new \InvalidArgumentException(
                'Invalid parameters: ' . $validator->errors()->first()
            );
        }

        return $validator->validated();
    }
}
```

### 2. –°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º

```php
class DataSanitizer
{
    public function sanitize(array $data): array
    {
        // –£–¥–∞–ª—è–µ–º –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –æ–ø–∞—Å–Ω—ã–µ –ø–æ–ª—è
        unset($data['auth_token'], $data['password']);

        // –û—á–∏—â–∞–µ–º HTML —Ç–µ–≥–∏ –∏–∑ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –ø–æ–ª–µ–π
        $textFields = ['name', 'description', 'address'];
        foreach ($textFields as $field) {
            if (isset($data[$field])) {
                $data[$field] = strip_tags($data[$field]);
            }
        }

        return $data;
    }
}
```

---

## üìù –ß–µ–∫–ª–∏—Å—Ç –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –§–∞–∑–∞ 1: –ë–∞–∑–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- [ ] –°–æ–∑–¥–∞—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã (ParserStrategyInterface, DataTransformerInterface)
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Factory –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–π
- [ ] –°–æ–∑–¥–∞—Ç—å –±–∞–∑–æ–≤—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ –æ–±—ä–µ–∫—Ç–æ–≤
- [ ] –°–æ–∑–¥–∞—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–π TrendParserService

### –§–∞–∑–∞ 2: –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- [ ] –°–æ–∑–¥–∞—Ç—å ImageUrlBuilder
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–µ—Ä—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞
- [ ] –ü—Ä–∏–≤–µ—Å—Ç–∏ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∫ –µ–¥–∏–Ω–æ–º—É —Ñ–æ—Ä–º–∞—Ç—É

### –§–∞–∑–∞ 3: –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–∞–≥–∏–Ω–∞—Ü–∏—é
- [ ] –î–æ–±–∞–≤–∏—Ç—å –º–∞—Å—Å–æ–≤—É—é –∑–∞–≥—Ä—É–∑–∫—É
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

### –§–∞–∑–∞ 4: –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å
- [ ] –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] –î–æ–±–∞–≤–∏—Ç—å retry –º–µ—Ö–∞–Ω–∏–∑–º

### –§–∞–∑–∞ 5: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- [ ] –î–æ–±–∞–≤–∏—Ç—å rate limiting
- [ ] –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–≤

---

## üéØ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã

1. **–í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:**
   - –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Strategy –ø–∞—Ç—Ç–µ—Ä–Ω–∞
   - –ï–¥–∏–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–µ—Ä—ã
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

2. **–°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:**
   - –ü–∞–≥–∏–Ω–∞—Ü–∏—è –∏ –º–∞—Å—Å–æ–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
   - –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

3. **–ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:**
   - –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
   - –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
   - –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

---

**–î–æ–∫—É–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ —Ç–µ–∫—É—â–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –∏ –≤—Å–µ—Ö API endpoints**

